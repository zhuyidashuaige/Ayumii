<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#0b1026" />
  <title>Bulan Purnama · Romansa Pertengahan Musim Gugur</title>
  <style>
    :root {
      --bg-start: #0b1026; /* 深夜蓝 */
      --bg-end: #302b63;   /* 暮紫蓝 */
      --accent: #ffd77a;   /* 月色金 */
      --accent-2: #ff9c9c; /* 温柔粉 */
      --card: rgba(255,255,255,0.08);
      --border: rgba(255,215,122,0.35);
      --text: #f6f7fb;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", "Hiragino Sans GB", "Source Han Sans SC", "Noto Sans CJK SC", system-ui, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 50% -20%, var(--bg-end), var(--bg-start));
      overflow: hidden;
    }

    /* 星光点点 */
    .stars {
      position: fixed; inset: 0; pointer-events: none;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.7), transparent 60%),
        radial-gradient(1.5px 1.5px at 70% 10%, rgba(255,255,255,0.6), transparent 60%),
        radial-gradient(2px 2px at 80% 60%, rgba(255,255,255,0.55), transparent 60%),
        radial-gradient(1px 1px at 35% 75%, rgba(255,255,255,0.6), transparent 60%),
        radial-gradient(1.5px 1.5px at 55% 45%, rgba(255,255,255,0.7), transparent 60%);
      animation: twinkle 6s infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 0.45; }
    }

    /* 页面布局 */
    .wrap {
      position: relative;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh; padding: 28px 16px 48px;
    }

    /* 标题与副标题 */
    .title {
      text-align: center; margin-bottom: 18px;
    }
    .title h1 {
      margin: 0;
      font-size: 28px; letter-spacing: 1px;
      background: linear-gradient(105deg, var(--accent), #fff); -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .title p {
      margin: 8px 0 0; color: #eaeaf7; font-size: 14px; opacity: 0.9;
    }

    /* 装饰月亮 */
    .moon {
      position: absolute; top: 56px; right: 12px; width: 90px; height: 90px;
      border-radius: 50%;
      background: radial-gradient(closest-side, #fff9e6, #ffe7a9 55%, rgba(255, 215, 122, 0.15));
      box-shadow: 0 0 40px rgba(255, 215, 122, 0.35);
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.15));
    }
    .moon:after {
      content: ""; position: absolute; left: 12px; top: 16px; width: 18px; height: 18px;
      border-radius: 50%; background: rgba(255, 210, 120, 0.35);
      box-shadow: 16px -10px 0 0 rgba(255, 210, 120, 0.25), -10px 12px 0 0 rgba(255, 210, 120, 0.2);
      transform: rotate(12deg);
    }

    /* 媒体窗口（包裹GIF）*/
    .window {
      width: 92vw; max-width: 420px; margin: 0 auto; border-radius: 18px;
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.06));
      border: 1px solid var(--border);
      box-shadow: 0 12px 36px rgba(0,0,0,0.35), inset 0 0 0 1px rgba(255,255,255,0.06);
      backdrop-filter: blur(2px);
    }

    .window-header {
      display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot.red { background: #ff6b6b; } .dot.gold { background: #ffd77a; } .dot.green { background: #9cffb0; }
    .window-title { flex: 1; text-align: center; font-size: 13px; color: #eaeaf7; opacity: 0.9; }

    .media {
      position: relative; overflow: hidden; border-bottom-left-radius: 18px; border-bottom-right-radius: 18px;
    }
    .media img { display: block; width: 100%; height: auto; }

    .gif { opacity: 1; transition: opacity 1s ease; }
    .jpg { position: absolute; inset: 0; opacity: 0; transition: opacity 1.2s ease; }
    .media.show-jpg .jpg { opacity: 1; }
    .media.show-jpg .gif { opacity: 0; }

    /* 页脚短句 */
    .footer {
      margin-top: 16px; text-align: center; font-size: 13px; color: #f3e9ff;
    }
    .footer .accent { color: var(--accent); }
  </style>
</head>
<body>
  <div class="stars"></div>
  <div class="wrap">
    <div class="moon" aria-hidden="true"></div>

    <div class="title" role="heading" aria-level="1">
      <h1>Bulan Purnama · Romansa Pertengahan Musim Gugur</h1>
      <p>Pada malam bulan purnama yang indah, mari kita nikmati terangnya bulan bersama-sama</p>
    </div>

    <section class="window" aria-label="中秋浪漫窗口">
      <div class="window-header">
        <span class="dot red"></span>
        <span class="dot gold"></span>
        <span class="dot green"></span>
        <div class="window-title">love_moon ·  Pandangan pertama cahaya bulan</div>
      </div>
      <div class="media" id="media">
        <img id="gif" class="gif" src="love_moon.gif" alt="中秋像素风GIF" />
        <img id="jpg" class="jpg" src="love_moon.jpg" alt="中秋浪漫定格图" />
      </div>
    </section>

    <div class="footer">Festival Pertengahan Musim Gugur memiliki Anda,<span class="accent">Cahaya bulan lebih lembut dan hati lebih hangat</div>
  </div>

  <script>
    // 解析 GIF 每帧延时，估算单轮播放时长（单位：毫秒）
    async function estimateGifDurationMs(url) {
      try {
        const res = await fetch(url, { cache: 'no-store' });
        const buf = await res.arrayBuffer();
        const bytes = new Uint8Array(buf);
        let totalHundredths = 0; // 单位：1/100 秒
        for (let i = 0; i < bytes.length - 5; i++) {
          if (bytes[i] === 0x21 && bytes[i + 1] === 0xF9 && bytes[i + 2] === 0x04) {
            const delay = (bytes[i + 4] | (bytes[i + 5] << 8));
            totalHundredths += delay;
          }
        }
        const ms = totalHundredths * 10; // 1/100秒 -> 10ms
        return ms > 0 ? ms : 25000; // 兜底提高到 25s
      } catch (e) {
        return 25000; // 本地 file:// 或解析失败时兜底 25s
      }
    }

    (async function run() {
      const media = document.getElementById('media');
      const jpg = document.getElementById('jpg');
      const preload = new Image();
      preload.src = jpg.getAttribute('src');
      if (preload.decode) { preload.decode().catch(() => {}); }

      const overrideAttr = media.getAttribute('data-switch-ms');
      const overrideMs = overrideAttr ? parseInt(overrideAttr, 10) : null;

      const duration = overrideMs ?? await estimateGifDurationMs('love_moon.gif');

      setTimeout(() => {
        media.classList.add('show-jpg');
      }, duration);
    })();
  </script>
</body>
</html>
